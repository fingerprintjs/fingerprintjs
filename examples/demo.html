<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FingerprintJS Optimizations Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            background: #fafbfc;
        }
        
        .section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .button:hover {
            background: #2980b9;
        }
        
        .button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ FingerprintJS Optimizations Demo</h1>
        
        <div class="section">
            <h2>üìä Performance Tests</h2>
            <button class="button" onclick="runBenchmarks()">Run Benchmarks</button>
            <button class="button" onclick="testOptimizations()">Test Optimizations</button>
            <button class="button" onclick="clearOutput()">Clear Output</button>
        </div>
        
        <div class="section">
            <h2>üìà Statistics</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="cache-size">-</div>
                    <div class="stat-label">Cache Size</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="hash-count">-</div>
                    <div class="stat-label">Hash Count</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-time">-</div>
                    <div class="stat-label">Avg Time (ms)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="memory-usage">-</div>
                    <div class="stat-label">Memory (MB)</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üìù Output</h2>
            <div class="output" id="output">Ready to run tests...</div>
        </div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º FingerprintJS
        let FingerprintJS;
        
        async function loadFingerprintJS() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ CDN
                const response = await fetch('https://openfpcdn.io/fingerprintjs/v4');
                const text = await response.text();
                
                // –°–æ–∑–¥–∞–µ–º –º–æ–¥—É–ª—å –∏–∑ —Ç–µ–∫—Å—Ç–∞
                const blob = new Blob([text], { type: 'application/javascript' });
                const url = URL.createObjectURL(blob);
                FingerprintJS = await import(url);
                
                log('‚úÖ FingerprintJS loaded successfully', 'success');
                return true;
            } catch (error) {
                log('‚ùå Failed to load FingerprintJS from CDN', 'error');
                log('Error: ' + error.message, 'error');
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–≤–æ–¥–∞
        window.clearOutput = function() {
            document.getElementById('output').innerHTML = 'Output cleared...\n';
        };
        
        // –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
        window.runBenchmarks = async function() {
            if (!FingerprintJS) {
                log('‚ùå FingerprintJS not loaded', 'error');
                return;
            }
            
            log('üöÄ Starting benchmarks...', 'info');
            
            try {
                // –°–æ–∑–¥–∞–µ–º –∞–≥–µ–Ω—Ç
                const agent = await FingerprintJS.load({
                    enableCache: true,
                    cacheTTL: 300000,
                    delayFallback: 25,
                    debug: false
                });
                
                // –¢–µ—Å—Ç –±–µ–∑ –∫—ç—à–∞
                log('üìä Testing without cache...', 'info');
                const start1 = performance.now();
                await agent.get();
                const time1 = performance.now() - start1;
                
                // –¢–µ—Å—Ç —Å –∫—ç—à–µ–º
                log('üìä Testing with cache...', 'info');
                const start2 = performance.now();
                await agent.get();
                const time2 = performance.now() - start2;
                
                // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                log(`‚è±Ô∏è  Without cache: ${time1.toFixed(2)}ms`, 'info');
                log(`‚è±Ô∏è  With cache: ${time2.toFixed(2)}ms`, 'info');
                
                const improvement = ((time1 - time2) / time1 * 100);
                log(`üöÄ Improvement: ${improvement.toFixed(1)}% faster with cache`, 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('avg-time').textContent = time2.toFixed(1);
                
            } catch (error) {
                log('‚ùå Benchmark failed: ' + error.message, 'error');
            }
        };
        
        // –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
        window.testOptimizations = async function() {
            if (!FingerprintJS) {
                log('‚ùå FingerprintJS not loaded', 'error');
                return;
            }
            
            log('üß™ Testing optimizations...', 'info');
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
                log('üîç Testing caching...', 'info');
                const agent = await FingerprintJS.load({
                    enableCache: true,
                    cacheTTL: 300000
                });
                
                // –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
                const start1 = performance.now();
                const result1 = await agent.get();
                const time1 = performance.now() - start1;
                
                log(`üì± First call: ${time1.toFixed(2)}ms`, 'info');
                log(`üÜî Visitor ID: ${result1.visitorId.substring(0, 16)}...`, 'info');
                log(`üéØ Confidence: ${(result1.confidence.score * 100).toFixed(1)}%`, 'info');
                
                // –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
                const start2 = performance.now();
                const result2 = await agent.get();
                const time2 = performance.now() - start2;
                
                log(`‚ö° Second call: ${time2.toFixed(2)}ms`, 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
                if (result1.visitorId === result2.visitorId) {
                    log('‚úÖ Caching working correctly - same visitor ID', 'success');
                } else {
                    log('‚ùå Caching failed - different visitor IDs', 'error');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('hash-count').textContent = '2';
                document.getElementById('avg-time').textContent = time2.toFixed(1);
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–∞–º—è—Ç—å
                if ('memory' in performance) {
                    const memory = performance.memory;
                    const memoryMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    document.getElementById('memory-usage').textContent = memoryMB;
                    log(`üíæ Memory usage: ${memoryMB}MB`, 'info');
                }
                
            } catch (error) {
                log('‚ùå Optimization test failed: ' + error.message, 'error');
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', async () => {
            log('üîÑ Loading FingerprintJS...', 'info');
            const loaded = await loadFingerprintJS();
            
            if (loaded) {
                log('üéâ Ready to run tests!', 'success');
                log('üí° Click "Run Benchmarks" or "Test Optimizations" to start', 'info');
            } else {
                log('üí° Try refreshing the page or check your internet connection', 'info');
            }
        });
    </script>
</body>
</html>